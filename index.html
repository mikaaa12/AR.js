<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AR.js GPS Demo</title>
    <!-- A-Frame Library -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        vr-mode-ui="enabled: false" 
        embedded
        arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: true;">
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <div id="status" style="position: absolute; top: 10px; left: 10px; background: white; padding: 10px; z-index: 10;">
        <p>Checking location...</p>
    </div>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerText = message;
        }

        // Function to fetch the device location
        function fetchLocation() {
            updateStatus('Requesting location...');
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log('Latitude:', position.coords.latitude);
                    console.log('Longitude:', position.coords.longitude);
                    updateStatus(`Location found: Latitude: ${position.coords.latitude}, Longitude: ${position.coords.longitude}`);

                    // Place an AR object at the device's location
                    const entity = document.createElement('a-box');
                    entity.setAttribute('gps-entity-place', `latitude: ${position.coords.latitude}; longitude: ${position.coords.longitude};`);
                    entity.setAttribute('scale', '5 5 5');
                    entity.setAttribute('material', 'color: red;');
                    document.querySelector('a-scene').appendChild(entity);
                },
                (err) => {
                    console.error('Error accessing location:', err);
                    updateStatus('Error accessing location: ' + err.message);
                },
                {
                    enableHighAccuracy: true, // Minta GPS
                    timeout: 60000,           // Timeout 60 detik
                    maximumAge: 0             // Dapatkan lokasi terbaru
                }
            );
        }

        // Check geolocation permission state
        navigator.permissions.query({ name: 'geolocation' }).then((result) => {
            console.log('Geolocation permission state:', result.state);
            if (result.state === 'granted') {
                fetchLocation();
            } else if (result.state === 'prompt') {
                updateStatus('Waiting for permission to access location...');
                fetchLocation();
            } else {
                updateStatus('Geolocation permission denied');
                console.warn('Geolocation permission denied');
            }

            result.onchange = () => {
                console.log('Geolocation permission state changed to:', result.state);
                if (result.state === 'granted') {
                    fetchLocation();
                } else {
                    updateStatus('Geolocation permission changed to denied');
                }
            };
        }).catch((error) => {
            console.error('Error checking geolocation permission:', error);
            updateStatus('Error checking geolocation permission');
        });
    </script>
</body>
</html>
